import{u as useConfigStore}from"./config-enqUxMCB.js";import{B as defineStore,b as ref,d as reactive,_ as _export_sfc,C as useCssVars,s as storeToRefs,D as computed,c as createElementBlock,A as createBaseVNode,a as createVNode,w as withCtx,u as unref,F as Fragment,g as renderList,G as ElMessageBox,h as router,v as ElButton,H as ElCountdown,I as ElProgress,J as ElPopconfirm,K as ElDialog,o as openBlock,f as createTextVNode,L as back_default,M as toDisplayString,N as check_default,O as ElDivider,P as ElTag,p as ElInput,Q as ElRate}from"./index-BH4QiIqN.js";const useAppStore=defineStore("app",()=>{const isComplete=ref(!1),countDown=reactive({start:0,end:0}),calcList=ref([]),setComplete=t=>{isComplete.value=t},setCountDown=t=>{const e=Date.now();countDown.start=e,countDown.end=countDown.start+1e3*60*(t??0)},setCalcList=(val,ops,bit,cnt)=>{calcList.value=Array.from({length:cnt},(_,idx)=>{const numbers=Array.from({length:val},(t,e)=>e+1);let params=Array.from({length:bit},()=>numbers[Math.floor(Math.random()*numbers.length)]),formula=params.reduce((t,e)=>`${t} ${ops[Math.floor(Math.random()*ops.length)]} ${e}`),value=eval(formula);for(;value<0||value>val||calcList.value.map(t=>t.formula).includes(formula);)params=Array.from({length:bit},()=>numbers[Math.floor(Math.random()*numbers.length)]),formula=params.reduce((t,e)=>`${t} ${ops[Math.floor(Math.random()*ops.length)]} ${e}`),value=eval(formula);return{id:idx+1,formula,value:void 0}})};return{isComplete,countDown,calcList,setCalcList,setComplete,setCountDown}}),_hoisted_1={id:"container",class:"container"},_hoisted_2={class:"header"},_hoisted_3={class:"header__left"},_hoisted_4={class:"header__mid"},_hoisted_5={class:"header__right"},_hoisted_6={class:"body"},_hoisted_7={class:"dialog-score"},_hoisted_8={class:"demonstration"},_hoisted_9={class:"dialog-score"},_sfc_main={__name:"PageView",setup(__props){var t;useCssVars(e=>({"59eec48f":containerHeight.value}));const appStore=useAppStore(),{configs}=useConfigStore(),{isComplete,countDown,calcList}=storeToRefs(appStore);appStore.setCountDown(configs.timer),appStore.setCalcList(configs.type.value??0,(t=configs.schema)==null?void 0:t.map(e=>e.value),configs.bit.value??2,configs.cnt??0);const goBack=()=>{isComplete.value?router.push({path:"/homes"}).then(()=>{appStore.setComplete(!1)}):ElMessageBox.confirm("此操作会清空已经做的题目，是否返回上一页？","警告",{confirmButtonText:"确认",showCancelButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1,type:"warning",center:!0,roundButton:!0}).then(()=>{router.push({path:"/homes"}).then(()=>{appStore.setComplete(!1)})}).catch(e=>{console.log(e)})},showScore=ref(!1),correct=ref(0),score=computed(()=>Number((correct.value/configs.cnt*5).toFixed(2))),handleSubmit=()=>{correct.value=0,showScore.value=!0;for(const{formula,value}of calcList.value)eval(formula)==Number(value)&&++correct.value;appStore.setComplete(!0)},colors=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],percentage=computed(()=>{let e=0;for(const{value:o}of calcList.value)typeof o<"u"&&String(o).replace(/\s+/g,"")!==""&&e++;return Math.round(e/configs.cnt*100)}),containerHeight=computed(()=>{const e=document.getElementById("app");return document.getElementById("container").clientHeight>e.clientHeight?"100%":"auto"}),doFinish=()=>{ElMessageBox.confirm("已经到时间啦！","警告",{confirmButtonText:"确认",showCancelButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1,type:"warning",center:!0,showClose:!1}).then(handleSubmit)};return(e,o)=>{const s=ElButton,n=ElCountdown,c=ElProgress,l=ElPopconfirm,r=ElDivider,i=ElTag,u=ElInput,d=ElRate,p=ElDialog;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(s,{icon:unref(back_default),link:"",size:"large",onClick:goBack},{default:withCtx(()=>[createTextVNode("返回")]),_:1},8,["icon"])]),createBaseVNode("div",_hoisted_4,[createVNode(n,{format:"mm:ss",value:unref(countDown).end,onFinish:doFinish},null,8,["value"])]),createBaseVNode("div",_hoisted_5,[createVNode(c,{type:"circle",indeterminate:"",percentage:percentage.value,color:colors,width:50},null,8,["percentage"]),createVNode(l,{title:"是否提交考卷?",onConfirm:handleSubmit,"confirm-button-text":"是","cancel-button-text":"否"},{reference:withCtx(()=>[createVNode(s,{type:"warning"},{default:withCtx(()=>[createTextVNode("提交")]),_:1})]),_:1})])]),createVNode(r,{style:{margin:"12px 0"}}),createBaseVNode("div",_hoisted_6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(calcList),a=>(openBlock(),createElementBlock("div",{class:"body_item",key:a.id},[createVNode(i,{class:"header__body_item_left",type:"primary"},{default:withCtx(()=>[createTextVNode(toDisplayString(a.formula+" ="),1)]),_:2},1024),createVNode(u,{class:"header__body_item_right",type:"number",size:"small","controls-position":"right",modelValue:a.value,"onUpdate:modelValue":m=>a.value=m},null,8,["modelValue","onUpdate:modelValue"])]))),128))])]),createVNode(p,{modelValue:showScore.value,"onUpdate:modelValue":o[2]||(o[2]=a=>showScore.value=a),"align-center":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_9,[createVNode(s,{type:"success",icon:unref(check_default),onClick:o[1]||(o[1]=a=>showScore.value=!1)},{default:withCtx(()=>[createTextVNode("确认")]),_:1},8,["icon"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_7,[createBaseVNode("span",_hoisted_8,toDisplayString(correct.value)+" / "+toDisplayString(unref(configs).cnt),1),createVNode(d,{size:"large",modelValue:score.value,"onUpdate:modelValue":o[0]||(o[0]=a=>score.value=a),"allow-half":"",disabled:""},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}},PageView=_export_sfc(_sfc_main,[["__scopeId","data-v-d1140cff"]]);export{PageView as default};
